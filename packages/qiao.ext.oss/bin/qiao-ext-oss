#!/usr/bin/env node

'use strict';

var qiaoExtOss = require('../lib/qiao.ext.oss.js');

// args
var args = process.argv.slice(2);

// check args
if(!args || !(args.length == 3 || args.length == 4)){
	console.log('upload file:');
	console.log('	qiao-ext-oss file test/test.js d:/test.js [info]');
	console.log('upload folder:');
	console.log('	qiao-ext-oss folder test d:/test [info]');
	
	return;
}

// check cmd
var cmd = args[0];
if(cmd != 'file' && cmd != 'folder'){
	console.log('only support file, folder cmd');
	
	return;
}

// client
var client;
try{
	client = qiaoExtOss.client(require(process.cwd() + '/config.json'));
}catch(e){
	console.log('you need put config.json into this path');
	
	return;
}

// upload file
var uploadFile = async function(path1, path2){
	try{
		var rs = await qiaoExtOss.uploadFileSync(client, path1, path2);
		
		console.log();
		console.log('upload file to alioss success !');
		console.log();
	
		if(args.length == 4 && args[3] == 'info') console.log(rs.url);
	}catch(e){
		console.log();
		console.log('upload file to alioss fail!');
		console.log();
		console.log(e);
	}
};

// upload folder
var uploadFolder = async function(path1, path2){
	try{
		var rs = await qiaoExtOss.uploadFolderSync(client, path1, path2);
		
		console.log();
		console.log('upload folder to alioss success !');
		console.log();
		
		if(args.length == 4 && args[3] == 'info')
			for(var i=0; i<rs.length; i++) console.log(rs[i].url);
	}catch(e){
		console.log();
		console.log('upload folder to alioss fail!');
		console.log();
		console.log(e);
	}
};

// paths
var path1 = args[1];
var path2 = args[2];

// upload file
if(cmd == 'file'){
	uploadFile(path1, path2);
	
	return;
}

// upload folder
if(cmd == 'folder'){
	uploadFolder(path1, path2);

	return;
}